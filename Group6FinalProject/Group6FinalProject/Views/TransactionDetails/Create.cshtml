@model Group_6_Final_Project.Models.TransactionDetail

@{
    ViewData["Title"] = "Create";
    Layout = "_Layout";
    var seatNumbers = Enum.GetValues(typeof(SeatSelection)).Cast<SeatSelection>().ToList();
    var paymentMethods = Enum.GetNames(typeof(PaymentMethod));
}

<br />
<h1>Add Transaction Details</h1>
<hr />

<div class="row">
    <div class="col-md-8">
        <form asp-action="Create">
            <div class="form-group">
                <label style="font-weight: bold;">Schedule ID:</label>
                <br />
                @Model.ScheduleID
            </div>
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <!--Hidden field for TransactionID-->
            @Html.HiddenFor(model => model.Transaction.TransactionID)

            <!--Pre-filled Movie Title-->
            <p>
                <div class="form-group">
                    <label style="font-weight: bold;">Movie Title:</label>
                    <br />
                    @ViewBag.SelectedMovieTitle
                </div>
            </p>

            <div class="form-group">
                <label asp-for="NumberofTickets" class="control-label"></label>
                <input asp-for="NumberofTickets" class="form-control" />
                <span asp-validation-for="NumberofTickets" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label asp-for="SchedulePrice" class="control-label"></label>
                <input asp-for="SchedulePrice" class="form-control" />
                <span asp-validation-for="SchedulePrice" class="text-danger"></span>
            </div>

            <div class="form-group">
                <label class="control-label">Select Seats:</label>
                <div id="seatSelection">
                    @foreach (var seat in seatNumbers)
                    {
                        <span class="seat" data-seat-id="@seat">@seat</span>
                    }
                </div>
                <input type="hidden" name="selectedSeats" id="selectedSeats" />
            </div>

            <div class="form-group">
                <label asp-for="PaymentMethod" class="control-label"></label>
                <select asp-for="PaymentMethod" class="form-control">
                    @foreach (var paymentMethod in paymentMethods)
                    {
                        <option value="@paymentMethod">@paymentMethod</option>
                    }
                </select>
                <span asp-validation-for="PaymentMethod" class="text-danger"></span>
            </div>

            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index" asp-route-orderId="@Model.Transaction.TransactionID">Back to List</a>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('.seat').click(function () {
                $(this).toggleClass('selected');
                updateSelectedSeats();
            });

            function updateSelectedSeats() {
                var selectedSeats = $('.seat.selected').map(function () {
                    return $(this).data('seat-id');
                }).get();
                $('#selectedSeats').val(selectedSeats.join(','));
            }
        });
    </script>
}

<style>
    .seat {
        display: inline-block;
        width: 30px;
        height: 30px;
        background-color: green;
        border: 1px solid #ddd;
        cursor: pointer;
        text-align: center;
        line-height: 30px;
        margin: 2px;
    }

    .seat.selected {
        background-color: red;
    }
</style>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"></script>
